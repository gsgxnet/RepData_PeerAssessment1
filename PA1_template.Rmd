---
title: "Reproducible Research: Peer Assessment 1"
author: gsgxnet
output: 
  html_document:
    keep_md: true
    toc: yes
---
```{r setoptions, echo=FALSE}
library(knitr)
opts_chunk$set(echo=TRUE, results="show")  # make all R scripts chunks and their results visible in the knitted document
```

## Introduction

We are evaluating a sample of 61 days of a persons activity data collected by a personal tracking device in 5 minute intervals.   

## Preparing the environment

to load and process the data we need to prepare our environment with the 
needed libraries and setup some variables and functions.  

### Load libraries
```{r setup}
library(data.table)  # keep all datasets in an optimal structure 
library(xtable)  # visualize tables
library(lattice)  # plot panels
```
### Get data 
```{r getdata}
unzip("activity.zip")
```

## Loading and preprocessing the data

### load data into a data.table

```{r readdata}
activity <- fread("activity.csv", header = TRUE)
```
The variables included in this dataset are:

* **steps**: Number of steps taking in a 5-minute interval (missing
    values are coded as `NA`)

* **date**: The date on which the measurement was taken in YYYY-MM-DD
    format

* **interval**: Identifier for the 5-minute interval in which
    measurement was taken  
    
### a tiny subset of the data as a preview
```{r showdata, results='asis'}
xt <- xtable(activity[date=="2012-10-04" & interval >= 1100 & interval < 1200,])
print(xt, type="HTML")
```

## What is mean total number of steps taken per day?

### process raw to analysis data
```{r databyday}
activitybyday <- activity[, .(stepsday=sum(steps)), by=date] # 
```
### histogram of the steps per day 
```{r histsteps}
hist(activitybyday[, stepsday], breaks=25, xlim=c(0,25000), ylim=c(0,20), col=blues9, main = paste0("Steps per Day (", activitybyday[1,date], " - ", activitybyday[.N,date],")"), xlab = "total number of steps")
```

### mean and median 

```{r}
stepsdaymean <- mean(activitybyday[, stepsday], na.rm = TRUE)
stepsdaymedian <- median(activitybyday[, stepsday], na.rm = TRUE)
```
The mean activity per day reported by the activitytracker is `r as.character(round(stepsdaymean, digits=1))` steps.  Their median is `r stepsdaymedian`. 


## What is the average daily activity pattern?

### process raw to analysis data
```{r activitybyinterval}
activitybyinterval <- activity[, .(stepsintvmean=mean(steps,na.rm = TRUE)), by=interval]
stepsintvmax <- max(activitybyinterval[, stepsintvmean], na.rm = TRUE)
stepsintvmaxintv <- activitybyinterval[which.max(stepsintvmean), ]

```
The interval of the day with the maximum mean number of steps is `r stepsintvmaxintv$interval`. For that timeslot the mean over all days is `r stepsintvmaxintv$stepsintvmean` steps.

### timeline of daily activity
```{r plotbyinterval}
plot(activitybyinterval,type="l", main = "steps per 5 min interval means ", xlab = "time of day interval", ylab = "mean number of steps" )
grid()
points(stepsintvmaxintv$interval, stepsintvmaxintv$stepsintvmean, col="blue", pch=21, bg = "red")
```


## Imputing missing values

### process raw to analysis data

There are missing values (NAs) in the original datasets. The presence of missing days may introduce bias into some calculations or summaries of the data. We can improve on that possible bias by replacing a missing value in an day-interval by the mean value of that interval calculated over all other days fow which a value exists. A new dataset for analysis and the days mean and median are calculated.  

```{r}
activityimputed <- activity # create a copy of the dataset
# calculated a new column in the dataset 
# containig either the mean of steps for that interval over all days if the number of steps is NA 
# or a copy of the value of the number of steps in that interval
activityimputed <- activityimputed[, `:=`(stepsimputed = ifelse( is.na(steps), mean(steps,na.rm = TRUE), steps)), by=interval]
activityimputedbyday <- activityimputed[, .(stepsimputedday=sum(stepsimputed)), by=date]
stepsimputeddaymean <- mean(activityimputedbyday[, stepsimputedday])
stepsimputeddaymedian <- median(activityimputedbyday[, stepsimputedday])
```
The mean activity per day reported by the activitytracker corrected for missing values is `r as.character(round(stepsimputeddaymean, digits=1))` steps.  Their median is `r as.character(round(stepsimputeddaymedian, digits=1))`. Compared to the mean of steps without correction there is no difference. Comparing medians, the median after imputing is 1.2 steps higher than the median calculated without correction. This kind of NA replacement has no impact on the calculated mean activity per day and an non significant impact on the median.  

### histogram of the steps imputed per day 
```{r histstepsimputed}
hist(activityimputedbyday[, stepsimputedday], breaks=25, xlim=c(0,25000), ylim=c(0,20), col=blues9, main = paste0("Steps imputed per Day (", activityimputedbyday[1,date], " - ", activityimputedbyday[.N,date],")"), xlab = "total number of steps imputed")
```  

The histogram for the imputed steps values shows a different distribution of total number of steps than the histogram for the raw total number containing NAs. The Frequency for the 10000 to 11000 range is now 18 instead of 10. This could be caused by imputing whole days of NAs with means of the other days intervals. 

## Are there differences in activity patterns between weekdays and weekends?

### process raw to analysis data

```{r weekdays}
activityimputedWd <- activityimputed # create a copy of the working dataset
# create a new column in the dataset marking every row as either weekday or weekend 
activityimputedWd[, `:=`(wkdayend = as.factor(ifelse(weekdays(as.Date(date), abbreviate = TRUE) %in% c("Sat","Sun"),"weekend","weekday")))]
# calculate the interval means for weekdays and weekends
activityimputedbyinterval <- activityimputedWd[, .(stepsimputedintvmean=mean(stepsimputed)), by=.(interval,wkdayend)]
```

### activity pattern plot for weekdays and weekends

```{r weekdayendplot}
library(lattice)
xyplot(activityimputedbyinterval$stepsimputedintvmean ~ activityimputedbyinterval$interval | activityimputedbyinterval$wkdayend, layout = c(1, 2), xlab = "Interval", ylab = "Number of steps", type="l")
```

### Summary

The patterns for weekends and weekdays look quite different. Further evaluation might reveal a statistical model to discern for a new days dataset whether it is data of a working day or not.
